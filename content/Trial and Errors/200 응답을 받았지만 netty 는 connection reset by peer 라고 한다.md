
서비스 배포 중 일어난 일이었다. 배포되는 서비스가 마지막으로 응답을 한 것을 받은 클라이언트가 reset by peer 에러를 냈다. 모순적인 디버그 로그를 보고 IO 로그를 살펴봤는데, 실제로 200 응답을 보낸 로그가 찍혀 있었다.

graceful shutdown 과 keep-alive 가 원인이 아닐까 예상중이다.

정체를 알기 위해선 재현을 해야 하니까, 서버가 다량의 요청을 받는 중 graceful shutdown이 되게 해봐야 한다.

실제 문제가 일어난 서버와 클라이언트를 직접 사용해 보는게 가장 확실할 것 같다. kube 환경까지 구성하긴 힘들 것 같다. 어쩌면 이 쪽에서 만들어 준 문제일 수 있어서.

